name: phalcon
version: 1.1.1
inherits: wercker/ubuntu12.04-webessentials@0.0.3
type: main
platform: ubuntu@12.04
no-response-timeout: 25
description: wercker box for phalcon
keywords:
  - php
  - php55
  - mysql
  - phalcon
  - phpunit
packages:
  - php@5.5
  - composer
  - phalcon
  - phpunit
script: |

  #update
  sudo apt-get update

  #install base package
  sudo apt-get install -y curl wget unzip ack-grep git
  sudo apt-get install software-properties-common
  sudo apt-get install apt-file && apt-file update
  sudo apt-get install python-software-properties

  sudo apt-get update

  # env path
  echo 'export PATH="/usr/local/bin:$PATH"' >> $HOME/.bash_profile

  sudo add-apt-repository ppa:ondrej/php5 -y
  sudo apt-get update -y

  sudo apt-key update

  #install mysql
  sudo debconf-set-selections <<< 'mysql-server mysql-server/root_password password your_password'
  sudo debconf-set-selections <<< 'mysql-server mysql-server/root_password_again password your_password'
  sudo apt-get -y install mysql-server  php5-mysql
  
  #install php 
  sudo apt-get install --force-yes -y php5 php5-cli php5-fpm php5-mysql php5-curl php5-gd php5-gmp php5-mcrypt php5-xdebug php5-memcached php5-imagick php5-intl php5-dev libpcre3-dev gcc make

  #install phalcon
  sudo apt-add-repository ppa:phalcon/stable

  sudo apt-get update -y 
  sudo apt-key update
  sudo apt-get install php5-phalcon

  # Configure PHP
  sudo sed -i 's+;date.timezone =+date.timezone = Europe/Rome +g' /etc/php5/cli/php.ini
  sudo sed -i 's/128M/8096M/' /etc/php5/cli/php.ini
  sudo sed -i 's/disable_functions/;disable_functions/' /etc/php5/cli/php.ini
  sudo sed -i 'aextension=pdo_mysql.so\n' /etc/php5/cli/php.ini
  sudo sed -i 'aextension=phalcon.so\n' /etc/php5/cli/php.ini
  
  # install composer
  curl -sS https://getcomposer.org/installer | php
  sudo mv composer.phar /usr/local/bin/composer
  sudo chmod +x /usr/local/bin/composer
  mkdir $WERCKER_CACHE_DIR/composer || echo "Composer cache directory exists"
  composer config --global cache-dir $WERCKER_CACHE_DIR/composer

  sudo composer self-update

  #PHP Unit
  sudo wget https://phar.phpunit.de/phpunit.phar
  sudo chmod +x phpunit.phar
  sudo mv phpunit.phar /usr/local/bin/phpunit

